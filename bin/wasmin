#!/bin/bash

BIN_SRC="$(realpath -- "${BASH_SOURCE[0]}"; )";
BIN_DIR="$(dirname -- "${BIN_SRC}" )";
#export WASMIN_COMPONENT=true

if [ -z "${WASMIN_ROOT}" ]; then
	WASMIN_ROOT="$(dirname "${BIN_DIR}"; )";
fi

if [ -z "${WASMIN_RUNTIME}" ]; then
	WASMIN_RUNTIME="node"
fi

if [ "${WASMIN_RUNTIME}" == "node" ]; then
	export V8_COMPILE_CACHE_CACHE_DIR=/tmp/v8-cache
	node  --experimental-wasm-stack-switching --wasm-staging --no-warnings --trace-warnings --enable-source-maps ${WASMIN_ROOT}/apps/node-shell/dist/index.js $*
	#node --liftoff-only --no-warnings --trace-warnings --enable-source-maps ${WASMIN_ROOT}/apps/node-shell/dist/index.js $*
	#node --no-liftoff --no-warnings --trace-warnings --enable-source-maps ${WASMIN_ROOT}/apps/node-shell/dist/index.js $*
	#node --turboshaft --turbo-stats --no-liftoff --trace-turbo-path=/tmp/turbo --no-warnings --trace-warnings --enable-source-maps ${WASMIN_ROOT}/apps/node-shell/dist/index.js $*
elif [ "${WASMIN_RUNTIME}" == "bun" ]; then
	bun ${WASMIN_ROOT}/apps/bun-shell/src/index.ts $* 
fi
